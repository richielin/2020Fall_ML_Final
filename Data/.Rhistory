x = incar_table$num,
by  = list(
Offense_Category = incar_table$Offense_Category,
title = incar_table$title
),
FUN = sum
)
incar_table <- merge(
incar_table,
aggregate(
x = incar_table$x,
by  = list(Offense_Category = incar_table$Offense_Category),
FUN = sum
),
by  = "Offense_Category",
all.x = T
)
incar_table[order(incar_table$Offense_Category, incar_table$title),]
incar_table$perc <-
round((incar_table$x.x / incar_table$x.y) * 100 , 1)
incar_table <-
incar_table[, c("Offense_Category", "title", "perc")]
incar_table <-
reshape(
incar_table,
idvar = "Offense_Category",
timevar = "title",
direction = "wide"
)
colnames(incar_table) <-
c("Charge Category", lapply(colnames(incar_table)[-1], function(x)
substr(x, 6, nchar(x))))
rownames(incar_table) <- NULL
incar_table[, 2:ncol(incar_table)] <-
round(incar_table[, 2:ncol(incar_table)], 1)
cpTreeList$incar_table <- incar_table
}
non_incar_table <-
tree[which(tree$title %in% unique(tree$sentence[which(tree$incarcerate == "Non-incarcerated")]) & !is.na(tree$sentence)), c("Offense_Category", "title", "num")]
if(nrow(non_incar_table) >0) {
non_incar_table <-
aggregate(
x = non_incar_table$num,
by  = list(
Offense_Category = non_incar_table$Offense_Category,
title = non_incar_table$title
),
FUN = sum
)
non_incar_table <- merge(
non_incar_table,
aggregate(
x = non_incar_table$x,
by  = list(Offense_Category = non_incar_table$Offense_Category),
FUN = sum
),
by  = "Offense_Category",
all.x = T
)
non_incar_table[order(non_incar_table$Offense_Category, non_incar_table$title),]
non_incar_table$perc <-
round((non_incar_table$x.x / non_incar_table$x.y) * 100 , 1)
non_incar_table <-
non_incar_table[, c("Offense_Category", "title", "perc")]
non_incar_table <-
reshape(
non_incar_table,
idvar = "Offense_Category",
timevar = "title",
direction = "wide"
)
colnames(non_incar_table) <-
c("Charge Category", lapply(colnames(non_incar_table)[-1], function(x)
substr(x, 6, nchar(x))))
rownames(non_incar_table) <- NULL
non_incar_table[, 2:ncol(non_incar_table)] <-
round(non_incar_table[, 2:ncol(non_incar_table)], 1)
cpTreeList$non_incar_table <- non_incar_table
}
# saveRDS(sentenceTable,"./sentenceTable.rds")
## ## Add colors to trees
## colors <- brewer.pal(9,"Blues")
## treeColors <- unlist(lapply(tree$perc, function(x) colors[ceiling(x/(100/9))]))
## tree$color <- treeColors
print("Case processing tables built")
cpTreeList$tree <- tree
# saveRDS(tree,"./cookCountyTree.rds")
### MERGE IN OFFENSE CATEGORY VARIABLE ####
initiationDisposition <-
left_join(initiationIntake,
dispositionTop,
by = c("CASE_ID", "CASE_PARTICIPANT_ID"))
classes <- c("X", "1", "2", "3", "4", "A", "B", "C")
initiationDisposition$init.class <-
factor(initiationDisposition$CLASS, levels = classes)
initiationDisposition$disp.class <-
factor(initiationDisposition$DISPOSITION_CHARGED_CLASS, levels = classes)
initiationDisposition$class.change <-
as.numeric(initiationDisposition$disp.class) - as.numeric(initiationDisposition$init.class)
initiationSentence <-
left_join(initiationTopCharge,
sentenceTop,
by = c("CASE_ID", "CASE_PARTICIPANT_ID"))
initiationSentence$init.class <-
factor(initiationSentence$CLASS, levels = classes)
initiationSentence$disp.class <-
factor(initiationSentence$DISPOSITION_CHARGED_CLASS, levels = classes)
initiationSentence$class.change <-
as.numeric(initiationSentence$disp.class) - as.numeric(initiationSentence$init.class)
## Top Charges by Category
topCharges <- list()
for (off in topOffenses) {
tblNum <-
sort(table(droplevels(
as.factor(initiationIntake$SECTION[which(initiationIntake$Offense_Category ==
off)])
)), decreasing = T)
tblPerc <- prop.table(tblNum) * 100
topCharges[[off]] <- data.frame(
"Charge" = names(tblNum),
"Number" = format(as.numeric(tblNum), big.mark =
","),
"Percent" = round(as.numeric(tblPerc), digits =
1)
)
}
cpTreeList$topCharges <- topCharges
# saveRDS(topCharges,"./topCharges.rds")
guilty <-
initiationDisposition[which(initiationDisposition$disposition %in% c("Found Guilty", "Pled Guilty") ),]
chargeDrop <- list()
for (off in topOffenses) {
df <- guilty[which(guilty$Offense_Category == off),]
tbl <- prop.table(table(df$class.change > 0)) * 100
chargeDrop[[off]] <- tbl
}
cpTreeList$chargeDrop <- chargeDrop
# saveRDS(chargeDrop,"./chargeDrop.rds")
classChange <- list()
classChangeMatrix <- list()
for (off in topOffenses) {
df <- guilty[which(guilty$Offense_Category == off),]
tbl <- table(df$init.class, df$disp.class)[classes[1:8],]
mx <- as.data.frame.matrix(tbl)
rownames(mx) <-
c("Fel.X",
"Fel.1",
"Fel.2",
"Fel.3",
"Fel.4",
"Mis.A",
"Mis.B",
"Mis.C")
colnames(mx) <-
c("Fel.X",
"Fel.1",
"Fel.2",
"Fel.3",
"Fel.4",
"Mis.A",
"Mis.B",
"Mis.C")
classChangeMatrix[[off]] <- mx
links <- as.data.frame(tbl)
names(links) <- c("parent", "child", "num")
links <- links[which(links$num != 0),]
classChange[[off]] <- links
}
cpTreeList$classChange <- classChange
cpTreeList$classChangeMatrix <- classChangeMatrix
print("Charge drop table built")
# saveRDS(classChange,"./classChange.rds")
### Return Output ####
return(cpTreeList)
}
treeDate <-
c("2011",
"2012",
"2013" ,
"2014",
"2015",
"2016",
"2017",
"2018",
"2019",
"2020")
topOffenses <- c(
"Aggravated Battery of a Police Officer",
"Battery",
"Burglary",
"Driving With Suspended Or Revoked License",
"DUI",
"Forgery" ,
"Homicide" ,
"Narcotics",
"Possession of Stolen Motor Vehicle",
"Retail Theft" ,
"Robbery",
"Sex Crimes" ,
"Theft",
"UUW - Unlawful Use of Weapon"
)
s
cpTreeList <- list()
for (i in treeDate) {
cpTreeList[[paste0("t", i)]] <- buildTree(i)
print(i)
}
cpTreeList$alv <-
buildTree(c("2011", "2012", "2013" , "2014", "2015", "2016"))
cpTreeList$foxx <- buildTree(c("2017", "2018", "2019","2020"))
cpTreeList$all <- buildTree(treeDate)
intake_raw_backup <-  intake_raw
intake_raw <- intake_raw[which(intake_raw$AGE_AT_INCIDENT <= 17),]
cpTreeList$juv <- buildTree(treeDate)
cpTreeList$juv_alv <-
buildTree(c("2011", "2012", "2013" , "2014", "2015", "2016"))
cpTreeList$juv_foxx <- buildTree(c("2017", "2018", "2019","2020"))
intake_raw <- intake_raw_backup
rm(intake_raw_backup)
saveRDS(cpTreeList, "./cpTreeListAll.rds")
cpTreeList$t2020
library(data.table)
library(lubridate)
library(devtools)
library(ggplot2)
# df <- fread("https://data.cityofnewyork.us/resource/ic3t-wcy2.csv?$query=select%20*%20limit%209999999")
# fwrite(df, "C:\\Users\\Richie\\iCloudDrive\\PHD\\Classes\\DS\\Machine Learning\\Final\\Data\\DOB_12152020.csv")
# df <- fread("https://data.cityofnewyork.us/resource/nc67-uf89.csv?$query=select%20*%20limit%2099999999")
# fwrite(df, "C:\\Users\\Richie\\iCloudDrive\\PHD\\Classes\\DS\\Machine Learning\\Final\\Data\\Parking_01102021.csv")
#
## Loading data
setwd("C:\\Users\\Richie\\iCloudDrive\\PHD\\Classes\\DS\\Machine Learning\\Final\\Data\\")
df <- fread("C:\\Users\\Richie\\iCloudDrive\\PHD\\Classes\\DS\\Machine Learning\\Final\\Data\\Parking_01102021.csv",
nrow = 5000000, stringsAsFactors = T)
## Cleaning data
df <- df[, -c("summons_number", "summons_image")]
df <- df[df$violation_status %in% c("HEARING HELD-GUILTY",  "HEARING HELD-GUILTY REDUCTION", "HEARING HELD-NOT GUILTY")]
df <- df[!is.na(df$violation_time)]
df[is.na(df$issue_date)]
df$state_rc <- as.factor(df$state)
df[df$state != 'NY', state_rc := "Non_NY"]
df$license_type_rc <- as.factor(df$license_type)
df$issue_date <- mdy(df$issue_date)
df <- df[!is.na(df$issue_date)]
df[, issue_month_rc := month(issue_date)]
df[, issue_year_rc := year(issue_date)]
df$violation_time <- format(strptime(paste0(df$violation_time,'M'), "%I:%M%p"), "%H:%M:%S")
df <- df[!is.na(df$violation_time)]
df[,vio_period_rc := NA]
df$vio_period_rc[as.numeric(substr(df$violation_time,1,2)) < 6] <- "Late Night"
df$vio_period_rc[as.numeric(substr(df$violation_time,1,2)) >= 6 & as.numeric(substr(df$violation_time,1,2)) <12 ] <-  "Morning"
df$vio_period_rc[as.numeric(substr(df$violation_time,1,2)) >= 12 & as.numeric(substr(df$violation_time,1,2)) <19 ] <- "Afternoon"
df$vio_period_rc[as.numeric(substr(df$violation_time,1,2)) >= 19 ]<- "Night"
table(df$fine_amount)
table(df$penalty_amount)
df$interest_amount[df$interest_amount < 0 ] <- 0
df$reduction_amount[df$reduction_amount < 0 ] <- 0
df$interest_amount_rc <- df$interest_amount
df$reduction_amount_rc <- df$reduction_amount
df$interest_amount_rc <- NA
df$interest_amount_rc[df$interest_amount == 0] <- 0
df$interest_amount_rc[df$interest_amount > 0 & !is.na(df$interest_amount)] <- as.character(cut(df$interest_amount[df$interest_amount > 0 & !is.na(df$interest_amount)], 8, dig.lab = 0))
df$interest_amount_rc <-  as.factor(df$interest_amount_rc)
table(df$interest_amount_rc)
df$reduction_amount_rc <- NA
df$reduction_amount_rc[df$reduction_amount == 0] <- 0
df$reduction_amount_rc[df$reduction_amount > 0 & !is.na(df$reduction_amount)] <- as.character(cut(df$reduction_amount[df$reduction_amount > 0 & !is.na(df$reduction_amount)], 8, dig.lab = 0))
df$interest_amount_rc <- as.factor(df$interest_amount_rc)
table(df$reduction_amount_rc)
df$precinct_rc <- as.factor(df$precinct)
df$county_rc <- as.factor(df$county)
df$violation_rc <- as.factor(df$violation)
df$violation_status_rc <- df$violation_status
df[, grep("_rc$", names(df)), with = F]
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) as.numeric(as.factor(x)))
df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")]
install.packages("BBmisc")
library(BBmisc)
normalize(df_cleaned)
normalize(df_cleaned)
df_cleaned
normalize(df_cleaned$violation_status_rc)
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) normalize(as.numeric(as.factor(x))))
df_cleaned
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) normalize(as.nuermic(as.factor(as.numeric(as.factor(x))))))
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) normalize(as.numeric(as.factor(as.numeric(as.factor(x))))))
df_cleaned
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) as.numeric(as.factor(as.numeric(as.factor(x)))))
df_cleaned
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) as.numeric(as.factor(x))))
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) as.numeric(as.factor(x)))
df_cleaned <- apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) as.numeric(as.factor(x)))
df_cleaned
df_cleaned <- as.data.frame(apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) as.numeric(as.factor(x))))
table(df_cleaned$license_type_rc)
df_cleaned <- as.data.frame(apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) normalize(as.numeric(as.factor(x)))))
df_cleaned
df_cleaned <- merge(df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")], df$violation_status_rc)
df_cleaned <- cbind(df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")], df$violation_status_rc)
df_cleaned
u1 = sum(df_cleaned["violation_status_rc" = "HEARING HELD-GUILTY",!(colnames(df_cleaned) == "violation_status_rc")])
sum(df_cleaned["violation_status_rc" = "HEARING HELD-GUILTY",!(colnames(df_cleaned) == "violation_status_rc")])
df_cleaned <- as.data.table(apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) normalize(as.numeric(as.factor(x)))))
df_cleaned <- cbind(df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")], df$violation_status_rc)
df_cleaned
df$violation_status_rc
df_cleaned <- as.data.frame(apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) normalize(as.numeric(as.factor(x)))))
df_cleaned <- cbind(df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")], df$violation_status_rc)
df_cleaned[violation_status_rc == "HEARING HELD-GUILTY",!(colnames(df_cleaned) == "violation_status_rc")
df_cleaned[violation_status_rc == "HEARING HELD-GUILTY",!(colnames(df_cleaned) == "violation_status_rc")]
df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")]
colnames(df_cleaned
)
df_cleaned <- cbind(df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")], violation_status_rc = df$violation_status_rc)
df_cleaned
df_cleaned <- data.table(cbind(df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")], violation_status_rc = df$violation_status_rc))
df_cleaned
df_cleaned <- as.data.frame(apply(df[, grep("_rc$", names(df)), with = F], 2, function(x) normalize(as.numeric(as.factor(x)))))
df_cleaned <- data.table(cbind(df_cleaned[,!(colnames(df_cleaned) == "violation_status_rc")], violation_status_rc = df$violation_status_rc))
df_cleaned
df_cleaned[,!(colnames(df_cleaned) != "violation_status_rc")]
colnames(df_cleaned) != "violation_status_rc")
u1 = sum(df_cleaned[,!(colnames(df_cleaned) != "violation_status_rc"), with = F])
df_cleaned[, setdiff(names(df_cleaned, "violation_status_rc"))]
df_cleaned[, setdiff(names(df_cleaned), "violation_status_rc")]
df_tuple <- df_cleaned[, setdiff(names(df_cleaned), "violation_status_rc"), with = F]
df_tuple
df_cleaned[violation_status_rc]
df_cleaned[,violation_status_rc]
df_class <- df_cleaned[,violation_status_rc]
u1 = colsum(df_cleaned[, ])
u1 = colSums(df_cleaned)
df_cleaned
u1 = colSums(df_tuple)
u1
u1 = colSums(df_tuple)/ nrow(df_tuple)
u1
u1 = colSums(df_tuple[df_class == 'HEARING HELD-GUILTY'])/ nrow(df_tuple[df_class == 'HEARING HELD-GUILTY'])
u1
u1 = colSums(df_tuple[df_class == 'HEARING HELD-GUILTY'])/ nrow(df_tuple[df_class == 'HEARING HELD-GUILTY'])
u2 = colSums(df_tuple[df_class == 'HEARING HELD-GUILTY REDUCTION'])/ nrow(df_tuple[df_class == 'HEARING HELD-GUILTY REDUCTION'])
u3 = colSums(df_tuple[df_class == 'HEARING HELD-NOT GUILTY'])/ nrow(df_tuple[df_class == 'HEARING HELD-NOT GUILTY'])
u1
u2
u3
u_all = colSums(df_tuple) / nrow(df_tuple)
u_all
n1 = nrow(df_tuple[df_class == 'HEARING HELD-GUILTY'])
n2 = nrow(df_tuple[df_class == 'HEARING HELD-GUILTY REDUCTION'])
n3 = nrow(df_tuple[df_class == 'HEARING HELD-NOT GUILTY'])
n_all = nrow(df_tuple)
n1 = nrow(df_tuple[df_class == 'HEARING HELD-GUILTY'])
n2 = nrow(df_tuple[df_class == 'HEARING HELD-GUILTY REDUCTION'])
n3 = nrow(df_tuple[df_class == 'HEARING HELD-NOT GUILTY'])
n_all = nrow(df_tuple)
u1 = colSums(df_tuple[df_class == 'HEARING HELD-GUILTY'])/ n1
u2 = colSums(df_tuple[df_class == 'HEARING HELD-GUILTY REDUCTION'])/ n2
u3 = colSums(df_tuple[df_class == 'HEARING HELD-NOT GUILTY'])/ n3
u_all = colSums(df_tuple) / n_all
u1
u2
u3
u_all
t(u1 - u_all)
n1(u1 - u_all)t(u1 - u_all)
n1(u1 - u_all)t(u1 - u_all)
n1*(u1 - u_all)*t(u1 - u_all)
(u1 - u_all)
t(u1 - u_all)
sb = sum(n1*(u1 - u_all)*t(u1 - u_all),
n2*(u2 - u_all)*t(u2 - u_all),
n1*(u3 - u_all)*t(u3 - u_all))
sb
n3*(u3 - u_all)*t(u3 - u_all)
u1 -  df_tuple
df_tuple[df_class == 'HEARING HELD-GUILTY',]
(u1 -  df_tuple[df_class == 'HEARING HELD-GUILTY',])*t(u1 -  df_tuple[df_class == 'HEARING HELD-GUILTY',])
sum((u1 -  df_tuple[df_class == 'HEARING HELD-GUILTY',])*t(u1 -  df_tuple[df_class == 'HEARING HELD-GUILTY',]))
x1 = df_tuple[df_class == 'HEARING HELD-GUILTY']
sum((u1 -  x1)*t(u1 - x1))
sw = sum(sum((u1 -  x1)*t(u1 - x1)),
sum((u2 -  x2)*t(u2 - x2)),
sum((u3 -  x3)*t(u3 - x3)))
x1 = df_tuple[df_class == 'HEARING HELD-GUILTY']
x2 = df_tuple[df_class == 'HEARING HELD-GUILTY REDUCTION']
x3 = df_tuple[df_class == 'HEARING HELD-NOT GUILTY']
n1 = nrow(x1)
n2 = nrow(x2)
n3 = nrow(x3)
n_all = nrow(df_tuple)
u1 = colSums(x1)/ n1
u2 = colSums(x2)/ n2
u3 = colSums(x3)/ n3
u_all = colSums(df_tuple) / n_all
u1
u2
u3
u_all
sb = sum(n1*(u1 - u_all)*t(u1 - u_all),
n2*(u2 - u_all)*t(u2 - u_all),
n3*(u3 - u_all)*t(u3 - u_all))
sw = sum(sum((u1 -  x1)*t(u1 - x1)),
sum((u2 -  x2)*t(u2 - x2)),
sum((u3 -  x3)*t(u3 - x3)))
sw
sb
x1 <- c(1,0,0); x2 <- c(1,2,3); y1 <- c(3,4,5); y2 <- rnorm(3)
# projection onto the 1 vector gives the mean vector
mean(y2)
project(y2, 1)
sb = sum(n1%*%(u1 - u_all)%*%t(u1 - u_all),
n2%*%(u2 - u_all)%*%t(u2 - u_all),
n3%*%(u3 - u_all)%*%t(u3 - u_all))
n1%*%(u1 - u_all)%*%t(u1 - u_all)
(u1 - u_all)%*%t(u1 - u_all)
n1*(u1 - u_all)%*%t(u1 - u_all)
sum(n1*(u1 - u_all)%*%t(u1 - u_all),
n2*(u2 - u_all)%*%t(u2 - u_all),
n3*(u3 - u_all)%*%t(u3 - u_all))
n1*(u1 - u_all)%*%t(u1 - u_all)
(u2 - u_all)%*%t(u2 - u_all)
(u1 - u_all)%*%t(u1 - u_all)
R1 = df_tuple[df_class == 'HEARING HELD-GUILTY']
R2 = df_tuple[df_class == 'HEARING HELD-GUILTY REDUCTION']
R3 = df_tuple[df_class == 'HEARING HELD-NOT GUILTY']
R = df_tuple
Z1 = nrow(R1)
Z2 = nrow(R2)
Z3 = nrow(R3)
Z = nrow(R)
mu1 = colSums(R1)/ Z1
mu2 = colSums(R2)/ Z2
mu3 = colSums(R3)/ Z3
mu = colSums(R)/ Z
SIGMA1 =  sum((R1 - mu1)%*%t(R1 - mu1)) /Z1 - 1
sum((R1 - mu1)%*%t(R1 - mu1))
t(R1 - mu1)
(R1 - mu1)
t(colSum(R1 - mu1))
t(colSum(R1 - mu1))
t(colSums(R1 - mu1))
colSums(R1 - mu1)%*%t(colSums(R1 - mu1))
colSums(R1 - mu1)%*%t(colSums(R1 - mu1)) /(Z1 - 1)
get_z <-  function(R){
Z = nrow(R)
return(Z)
}
Z1 = get_zR1)
Z1 = get_z(R1)
get_z(R1)
get_mu <- function(R, Z = get_z(R)){
mu = colSums(R) / Z
return(mu)
}
get_mu(R1)
get_sigma <- function(R, mu = get_mu(R), Z = get_z(R)) {
SIGMA =  colSums(R - mu)%*%t(colSums(R - mu)) /(Z1 - 1)
return(SIGMA)
}
get_sigma(R1)
get_sigma(R2)
get_sigma(R3)
eigen(get_sigma(R1))
trace(get_sigma(R1))
diag(get_sigma(R1))
sum(diag(get_sigma(R1)))
get_sigma(R1)[1,1]
sqrt(get_sigma(R1)[1,1])
i = 3
sum(diag(get_sigma(R1)[i,i])) / sum(diag(get_sigma(R1)))
sum(diag(get_sigma(R1)[i,i])) / sum(diag(get_sigma(R1)))
for (i in 1: ncol(get_sigma(R1))){
f <- sum(diag(get_sigma(R1)[i,i])) / sum(diag(get_sigma(R1)))
print(f)
}
for (i in 1: ncol(get_sigma(R1))){
f <- sum(diag(get_sigma(R1)[1:i,1:i])) / sum(diag(get_sigma(R1)))
print(f)
}
get_Ec <- function(R, f = .96){
for (Ec in 1: ncol(get_sigma(R1))){
f_test <- sum(diag(get_sigma(R1)[1:Ec,1:Ec])) / sum(diag(get_sigma(R1)))
if (f_test >= f) {
return(diag(get_sigma(R1)[1:Ec,1:Ec]))
break
}
}
}
get_Ec(R1, 0.3)
get_Ec <- function(R, f = .96){
for (Ec in 1: ncol(get_sigma(R1))){
f_test <- sum(diag(get_sigma(R1)[1:Ec,1:Ec])) / sum(diag(get_sigma(R1)))
if (f_test >= f) {
return(diag(get_sigma(R1)[1:Ec-1,1:Ec-1]))
break
}
}
}
get_Ec(R1, 0.3)
get_Ec <- function(R, f = .96){
sigma <- get_sigma(R)
for (Ec in 1: ncol(sigma)){
f_test <- sum(diag(sigma[1:Ec,1:Ec])) / sum(diag(sigma))
if (f_test >= f) {
return(diag(sigma[1:Ec-1,1:Ec-1]))
break
}
}
}
get_Ec(R1, 0.3)
get_Ec(R1)
